import{j as c}from"./motion-B-6xRUo4.js";import{a as o,b as H}from"./leaflet-CO0Iut3d.js";import{e as I}from"./index-DhrFu1uY.js";import"./charts-ksAtv-L-.js";function P({steps:g,open:r,onClose:E}){const[b,v]=o.useState(0),[p,L]=o.useState(null),x=o.useRef(null),f=o.useRef(null),[n,B]=o.useState({width:0,height:0}),[O,T]=o.useState({width:0,height:0});o.useId();const a=g[b],w=o.useMemo(()=>!r||!a?null:document.querySelector(a.selector),[r,a]),k=o.useCallback(()=>{if(!r||!w){L(null);return}const e=w.getBoundingClientRect();L(e)},[r,w]);if(o.useEffect(()=>{r&&v(0)},[r]),o.useEffect(()=>{r&&k()},[r,k]),o.useEffect(()=>{if(!r)return;const e=()=>k();window.addEventListener("resize",e),window.addEventListener("scroll",e,!0);const i=typeof ResizeObserver<"u"&&w?new ResizeObserver(e):null;return i&&w&&i.observe(w),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0),i?.disconnect()}},[r,k,w]),o.useLayoutEffect(()=>{if(!r||!x.current)return;const e=()=>{if(!x.current)return;const u=x.current.getBoundingClientRect();B({width:u.width,height:u.height})};e();const i=typeof ResizeObserver<"u"?new ResizeObserver(e):null;return i&&x.current&&i.observe(x.current),()=>i?.disconnect()},[r,a]),o.useEffect(()=>{if(!r)return;const e=document.documentElement.style.overflow,i=document.body.style.overflow;document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden";const u=s=>{s.key==="Escape"?(s.preventDefault(),E()):s.key==="ArrowRight"?(s.preventDefault(),v(m=>Math.min(g.length-1,m+1))):s.key==="ArrowLeft"&&(s.preventDefault(),v(m=>Math.max(0,m-1)))};window.addEventListener("keydown",u);const d=s=>{s.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),window.addEventListener("touchmove",d,{passive:!1}),()=>{window.removeEventListener("keydown",u),window.removeEventListener("wheel",d),window.removeEventListener("touchmove",d),document.documentElement.style.overflow=e,document.body.style.overflow=i}},[r,E,g.length]),o.useEffect(()=>{if(!r)return;const e=()=>Array.from(f.current?.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')??[]).filter(d=>!d.hasAttribute("disabled")),i=d=>{if(d.key!=="Tab")return;const s=e();if(!s.length)return;const m=s[0],z=s[s.length-1];d.shiftKey&&document.activeElement===m?(d.preventDefault(),z.focus()):!d.shiftKey&&document.activeElement===z&&(d.preventDefault(),m.focus())};return document.addEventListener("keydown",i),f.current?.querySelector('[data-tour-action="next"]')?.focus(),()=>document.removeEventListener("keydown",i)},[r,b]),o.useLayoutEffect(()=>{if(!r||!f.current)return;const e=()=>{if(!f.current)return;const u=f.current.getBoundingClientRect();T({width:u.width,height:u.height})};e();const i=typeof ResizeObserver<"u"?new ResizeObserver(e):null;return i&&f.current&&i.observe(f.current),()=>i?.disconnect()},[r]),o.useEffect(()=>{if(!r||!a)return;const e=document.querySelector(a.selector);e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[r,a]),!r||!a)return null;const y=12,t=p?{x:p.left-y,y:p.top-y,width:p.width+y*2,height:p.height+y*2}:null,D=14,R=typeof window<"u"?window.innerWidth:0,j=typeof window<"u"?window.innerHeight:0,N=a.placement,C=N==="top"||N!=="bottom"&&t&&t.y>=n.height+y*2;let h=t?t.x+t.width/2-n.width/2:R/2-n.width/2;h=Math.min(Math.max(h,16),R-n.width-16);let l;if(t?C?l=t.y-n.height-16:(l=t.y+t.height+16,l+n.height>j-16&&t.y>n.height&&(l=t.y-n.height-16)):l=j/2-n.height/2,l=Math.min(Math.max(l,16),j-n.height-16),t){const e=t.x+t.width,i=h+n.width,u=h<e&&i>t.x,d=l<t.y+t.height&&l+n.height>t.y;if(u&&d){const s=R-e-16,m=t.x-16;s>=n.width?h=e+16:m>=n.width?h=t.x-n.width-16:(l=Math.max(16,t.y-n.height-16),h=Math.min(Math.max(h,16),R-n.width-16))}}const S=j-O.height-24-16;l+n.height>S&&(l=Math.max(16,S-n.height));const M=!t,A=()=>{b===g.length-1?E():v(e=>Math.min(g.length-1,e+1))},q=()=>v(e=>Math.max(0,e-1));return H.createPortal(c.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-auto","aria-modal":"true",role:"dialog",children:[!t&&c.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[rgba(8,8,8,0.72)]"}),!M&&c.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute overflow-hidden rounded-[14px] border border-red-400/80 shadow-[0_0_24px_rgba(248,113,113,0.42)]",style:{left:t.x,top:t.y,width:t.width,height:t.height,borderRadius:D,boxShadow:"0 0 0 9999px rgba(8,8,8,0.72)"}}),c.jsxs("div",{ref:x,className:I("pointer-events-auto absolute max-w-sm rounded-xl border border-red-900/40 bg-black/85 p-4 text-sm text-red-100 shadow-xl backdrop-blur"),style:{left:h,top:l},children:[c.jsxs("div",{className:"flex items-center justify-between gap-3",children:[c.jsx("h2",{className:"text-base font-semibold uppercase tracking-widest",children:a.title}),c.jsxs("span",{className:"text-xs text-red-200/80",children:[b+1,"/",g.length]})]}),c.jsx("div",{className:"mt-2 text-xs text-red-200/80",children:M?"This stepâ€™s target is hidden. Continue to the next step.":a.description})]}),c.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-6 flex justify-center",children:c.jsxs("div",{ref:f,className:"pointer-events-auto flex items-center gap-3 rounded-full border border-red-900/50 bg-black/80 px-4 py-2 text-xs text-red-100 shadow-lg backdrop-blur",role:"toolbar",children:[c.jsx("button",{type:"button",onClick:E,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition hover:bg-red-900/40",children:"Close"}),c.jsx("button",{type:"button",onClick:q,disabled:b===0,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition enabled:hover:bg-red-900/40 disabled:opacity-40",children:"Back"}),c.jsx("button",{type:"button","data-tour-action":"next",onClick:A,className:"rounded-full border border-red-500/70 bg-red-600/30 px-4 py-1.5 font-semibold uppercase tracking-widest transition hover:bg-red-600/40",children:b===g.length-1?"Finish":"Next"})]})})]}),document.body)}export{P as default};
