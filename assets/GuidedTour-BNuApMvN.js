import{j as o}from"./motion-B-6xRUo4.js";import{a as s,b as K}from"./leaflet-CO0Iut3d.js";import{e as V}from"./index--8hyKBt_.js";import"./charts-ksAtv-L-.js";function J({steps:w,open:r,onClose:k}){const[b,v]=s.useState(0),[p,L]=s.useState(null),x=s.useRef(null),f=s.useRef(null),[n,O]=s.useState({width:0,height:0}),[T,D]=s.useState({width:0,height:0}),S=s.useId(),A=s.useMemo(()=>typeof window>"u"?!1:typeof window.CSS<"u"&&typeof window.CSS.supports=="function"?window.CSS.supports("mask-image","url(#test)"):!1,[]),a=w[b],g=s.useMemo(()=>!r||!a?null:document.querySelector(a.selector),[r,a]),E=s.useCallback(()=>{if(!r||!g){L(null);return}const t=g.getBoundingClientRect();L(t)},[r,g]);if(s.useEffect(()=>{r&&v(0)},[r]),s.useEffect(()=>{r&&E()},[r,E]),s.useEffect(()=>{if(!r)return;const t=()=>E();window.addEventListener("resize",t),window.addEventListener("scroll",t,!0);const i=typeof ResizeObserver<"u"&&g?new ResizeObserver(t):null;return i&&g&&i.observe(g),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0),i?.disconnect()}},[r,E,g]),s.useLayoutEffect(()=>{if(!r||!x.current)return;const t=()=>{if(!x.current)return;const u=x.current.getBoundingClientRect();O({width:u.width,height:u.height})};t();const i=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return i&&x.current&&i.observe(x.current),()=>i?.disconnect()},[r,a]),s.useEffect(()=>{if(!r)return;const t=document.documentElement.style.overflow,i=document.body.style.overflow;document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden";const u=d=>{d.key==="Escape"?(d.preventDefault(),k()):d.key==="ArrowRight"?(d.preventDefault(),v(m=>Math.min(w.length-1,m+1))):d.key==="ArrowLeft"&&(d.preventDefault(),v(m=>Math.max(0,m-1)))};window.addEventListener("keydown",u);const l=d=>{d.preventDefault()};return window.addEventListener("wheel",l,{passive:!1}),window.addEventListener("touchmove",l,{passive:!1}),()=>{window.removeEventListener("keydown",u),window.removeEventListener("wheel",l),window.removeEventListener("touchmove",l),document.documentElement.style.overflow=t,document.body.style.overflow=i}},[r,k,w.length]),s.useEffect(()=>{if(!r)return;const t=()=>Array.from(f.current?.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')??[]).filter(l=>!l.hasAttribute("disabled")),i=l=>{if(l.key!=="Tab")return;const d=t();if(!d.length)return;const m=d[0],C=d[d.length-1];l.shiftKey&&document.activeElement===m?(l.preventDefault(),C.focus()):!l.shiftKey&&document.activeElement===C&&(l.preventDefault(),m.focus())};return document.addEventListener("keydown",i),f.current?.querySelector('[data-tour-action="next"]')?.focus(),()=>document.removeEventListener("keydown",i)},[r,b]),s.useLayoutEffect(()=>{if(!r||!f.current)return;const t=()=>{if(!f.current)return;const u=f.current.getBoundingClientRect();D({width:u.width,height:u.height})};t();const i=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return i&&f.current&&i.observe(f.current),()=>i?.disconnect()},[r]),s.useEffect(()=>{if(!r||!a)return;const t=document.querySelector(a.selector);t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[r,a]),!r||!a)return null;const y=12,e=p?{x:p.left-y,y:p.top-y,width:p.width+y*2,height:p.height+y*2}:null,M=14,R=typeof window<"u"?window.innerWidth:0,j=typeof window<"u"?window.innerHeight:0,z=a.placement,q=z==="top"||z!=="bottom"&&e&&e.y>=n.height+y*2;let h=e?e.x+e.width/2-n.width/2:R/2-n.width/2;h=Math.min(Math.max(h,16),R-n.width-16);let c;if(e?q?c=e.y-n.height-16:(c=e.y+e.height+16,c+n.height>j-16&&e.y>n.height&&(c=e.y-n.height-16)):c=j/2-n.height/2,c=Math.min(Math.max(c,16),j-n.height-16),e){const t=e.x+e.width,i=h+n.width,u=h<t&&i>e.x,l=c<e.y+e.height&&c+n.height>e.y;if(u&&l){const d=R-t-16,m=e.x-16;d>=n.width?h=t+16:m>=n.width?h=e.x-n.width-16:(c=Math.max(16,e.y-n.height-16),h=Math.min(Math.max(h,16),R-n.width-16))}}const B=j-T.height-24-16;c+n.height>B&&(c=Math.max(16,B-n.height));const N=!e,H=()=>{b===w.length-1?k():v(t=>Math.min(w.length-1,t+1))},I=()=>v(t=>Math.max(0,t-1));return K.createPortal(o.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-auto","aria-modal":"true",role:"dialog",children:[o.jsx("svg",{className:"absolute inset-0 h-full w-full pointer-events-none","aria-hidden":!0,focusable:"false",children:o.jsx("defs",{children:o.jsxs("mask",{id:S,children:[o.jsx("rect",{width:"100%",height:"100%",fill:"white"}),!N&&o.jsx("rect",{x:e.x,y:e.y,width:e.width,height:e.height,rx:M,ry:M,fill:"black"})]})})}),o.jsx("div",{className:"absolute inset-0 pointer-events-none",style:e&&A?{background:"rgba(6, 6, 6, 0.72)",mask:`url(#${S})`,WebkitMask:`url(#${S})`}:{background:"rgba(6, 6, 6, 0.6)"}}),!N&&o.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute border border-red-400/90 shadow-[0_0_24px_rgba(248,113,113,0.6)]",style:{left:e.x,top:e.y,width:e.width,height:e.height,borderRadius:M}}),o.jsxs("div",{ref:x,className:V("pointer-events-auto absolute max-w-sm rounded-xl border border-red-900/40 bg-black/85 p-4 text-sm text-red-100 shadow-xl backdrop-blur"),style:{left:h,top:c},children:[o.jsxs("div",{className:"flex items-center justify-between gap-3",children:[o.jsx("h2",{className:"text-base font-semibold uppercase tracking-widest",children:a.title}),o.jsxs("span",{className:"text-xs text-red-200/80",children:[b+1,"/",w.length]})]}),o.jsx("div",{className:"mt-2 text-xs text-red-200/80",children:N?"This stepâ€™s target is hidden. Continue to the next step.":a.description})]}),o.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-6 flex justify-center",children:o.jsxs("div",{ref:f,className:"pointer-events-auto flex items-center gap-3 rounded-full border border-red-900/50 bg-black/80 px-4 py-2 text-xs text-red-100 shadow-lg backdrop-blur",role:"toolbar",children:[o.jsx("button",{type:"button",onClick:k,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition hover:bg-red-900/40",children:"Close"}),o.jsx("button",{type:"button",onClick:I,disabled:b===0,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition enabled:hover:bg-red-900/40 disabled:opacity-40",children:"Back"}),o.jsx("button",{type:"button","data-tour-action":"next",onClick:H,className:"rounded-full border border-red-500/70 bg-red-600/30 px-4 py-1.5 font-semibold uppercase tracking-widest transition hover:bg-red-600/40",children:b===w.length-1?"Finish":"Next"})]})})]}),document.body)}export{J as default};
