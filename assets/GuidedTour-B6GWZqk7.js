import{j as o}from"./motion-B-6xRUo4.js";import{a as s,b as I}from"./leaflet-CO0Iut3d.js";import{e as W}from"./index-sSWiq9_E.js";import"./charts-ksAtv-L-.js";function P({steps:b,open:r,onClose:k}){const[w,v]=s.useState(0),[p,S]=s.useState(null),x=s.useRef(null),f=s.useRef(null),[n,T]=s.useState({width:0,height:0}),[D,C]=s.useState({width:0,height:0}),N=s.useId(),a=b[w],g=s.useMemo(()=>!r||!a?null:document.querySelector(a.selector),[r,a]),E=s.useCallback(()=>{if(!r||!g){S(null);return}const t=g.getBoundingClientRect();S(t)},[r,g]);if(s.useEffect(()=>{r&&v(0)},[r]),s.useEffect(()=>{r&&E()},[r,E]),s.useEffect(()=>{if(!r)return;const t=()=>E();window.addEventListener("resize",t),window.addEventListener("scroll",t,!0);const i=typeof ResizeObserver<"u"&&g?new ResizeObserver(t):null;return i&&g&&i.observe(g),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0),i?.disconnect()}},[r,E,g]),s.useLayoutEffect(()=>{if(!r||!x.current)return;const t=()=>{if(!x.current)return;const u=x.current.getBoundingClientRect();T({width:u.width,height:u.height})};t();const i=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return i&&x.current&&i.observe(x.current),()=>i?.disconnect()},[r,a]),s.useEffect(()=>{if(!r)return;const t=document.documentElement.style.overflow,i=document.body.style.overflow;document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden";const u=l=>{l.key==="Escape"?(l.preventDefault(),k()):l.key==="ArrowRight"?(l.preventDefault(),v(m=>Math.min(b.length-1,m+1))):l.key==="ArrowLeft"&&(l.preventDefault(),v(m=>Math.max(0,m-1)))};window.addEventListener("keydown",u);const d=l=>{l.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),window.addEventListener("touchmove",d,{passive:!1}),()=>{window.removeEventListener("keydown",u),window.removeEventListener("wheel",d),window.removeEventListener("touchmove",d),document.documentElement.style.overflow=t,document.body.style.overflow=i}},[r,k,b.length]),s.useEffect(()=>{if(!r)return;const t=()=>Array.from(f.current?.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')??[]).filter(d=>!d.hasAttribute("disabled")),i=d=>{if(d.key!=="Tab")return;const l=t();if(!l.length)return;const m=l[0],O=l[l.length-1];d.shiftKey&&document.activeElement===m?(d.preventDefault(),O.focus()):!d.shiftKey&&document.activeElement===O&&(d.preventDefault(),m.focus())};return document.addEventListener("keydown",i),f.current?.querySelector('[data-tour-action="next"]')?.focus(),()=>document.removeEventListener("keydown",i)},[r,w]),s.useLayoutEffect(()=>{if(!r||!f.current)return;const t=()=>{if(!f.current)return;const u=f.current.getBoundingClientRect();C({width:u.width,height:u.height})};t();const i=typeof ResizeObserver<"u"?new ResizeObserver(t):null;return i&&f.current&&i.observe(f.current),()=>i?.disconnect()},[r]),s.useEffect(()=>{if(!r||!a)return;const t=document.querySelector(a.selector);t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[r,a]),!r||!a)return null;const y=12,e=p?{x:p.left-y,y:p.top-y,width:p.width+y*2,height:p.height+y*2}:null,L=14,R=typeof window<"u"?window.innerWidth:0,j=typeof window<"u"?window.innerHeight:0,z=a.placement,A=z==="top"||z!=="bottom"&&e&&e.y>=n.height+y*2;let h=e?e.x+e.width/2-n.width/2:R/2-n.width/2;h=Math.min(Math.max(h,16),R-n.width-16);let c;if(e?A?c=e.y-n.height-16:(c=e.y+e.height+16,c+n.height>j-16&&e.y>n.height&&(c=e.y-n.height-16)):c=j/2-n.height/2,c=Math.min(Math.max(c,16),j-n.height-16),e){const t=e.x+e.width,i=h+n.width,u=h<t&&i>e.x,d=c<e.y+e.height&&c+n.height>e.y;if(u&&d){const l=R-t-16,m=e.x-16;l>=n.width?h=t+16:m>=n.width?h=e.x-n.width-16:(c=Math.max(16,e.y-n.height-16),h=Math.min(Math.max(h,16),R-n.width-16))}}const B=j-D.height-24-16;c+n.height>B&&(c=Math.max(16,B-n.height));const M=!e,q=()=>{w===b.length-1?k():v(t=>Math.min(b.length-1,t+1))},H=()=>v(t=>Math.max(0,t-1));return I.createPortal(o.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-auto","aria-modal":"true",role:"dialog",children:[o.jsx("svg",{className:"absolute inset-0 h-full w-full pointer-events-none","aria-hidden":!0,focusable:"false",children:o.jsx("defs",{children:o.jsxs("mask",{id:N,children:[o.jsx("rect",{width:"100%",height:"100%",fill:"white"}),!M&&o.jsx("rect",{x:e.x,y:e.y,width:e.width,height:e.height,rx:L,ry:L,fill:"black"})]})})}),o.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"rgba(6, 6, 6, 0.72)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",mask:`url(#${N})`,WebkitMask:`url(#${N})`}}),!M&&o.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute border border-red-400/90 shadow-[0_0_24px_rgba(248,113,113,0.6)]",style:{left:e.x,top:e.y,width:e.width,height:e.height,borderRadius:L}}),o.jsxs("div",{ref:x,className:W("pointer-events-auto absolute max-w-sm rounded-xl border border-red-900/40 bg-black/85 p-4 text-sm text-red-100 shadow-xl backdrop-blur"),style:{left:h,top:c},children:[o.jsxs("div",{className:"flex items-center justify-between gap-3",children:[o.jsx("h2",{className:"text-base font-semibold uppercase tracking-widest",children:a.title}),o.jsxs("span",{className:"text-xs text-red-200/80",children:[w+1,"/",b.length]})]}),o.jsx("div",{className:"mt-2 text-xs text-red-200/80",children:M?"This stepâ€™s target is hidden. Continue to the next step.":a.description})]}),o.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-6 flex justify-center",children:o.jsxs("div",{ref:f,className:"pointer-events-auto flex items-center gap-3 rounded-full border border-red-900/50 bg-black/80 px-4 py-2 text-xs text-red-100 shadow-lg backdrop-blur",role:"toolbar",children:[o.jsx("button",{type:"button",onClick:k,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition hover:bg-red-900/40",children:"Close"}),o.jsx("button",{type:"button",onClick:H,disabled:w===0,className:"rounded-full border border-red-900/40 bg-black/60 px-3 py-1.5 transition enabled:hover:bg-red-900/40 disabled:opacity-40",children:"Back"}),o.jsx("button",{type:"button","data-tour-action":"next",onClick:q,className:"rounded-full border border-red-500/70 bg-red-600/30 px-4 py-1.5 font-semibold uppercase tracking-widest transition hover:bg-red-600/40",children:w===b.length-1?"Finish":"Next"})]})})]}),document.body)}export{P as default};
